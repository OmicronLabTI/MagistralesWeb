<div class="container-list-page">
    <div class="header-page">
        <div class="title-list-container">
            <span>Añadir componentes</span>
            <div class="breadcrumb" *ngIf="isFromDetail"><a *ngIf="document !== 0" class="breadcrumblink"
                    (click)="goToOrders(['pedidos'])">Pedidos / </a> <a *ngIf="document !== 0" class="breadcrumblink"
                    (click)="goToDetailOrder(['/pdetalle', document])">Detalle / </a> <a class="breadcrumblink"
                    (click)="goToOrdenFab(['/ordenfabricacion', ordenFabricacionId, detailOrders, isFromDetail ? '1' : '0'])">Fórmula</a>
                / Lotes </div>
            <div class="breadcrumb" *ngIf="!isFromDetail"><a class="breadcrumblink"
                    (click)="goToOrders(['ordenes'])">Órdenes de fabricación /</a> <a class="breadcrumblink"
                    (click)="goToOrdenFab(['/ordenfabricacion', ordenFabricacionId, detailOrders, isFromDetail ? '1' : '0'])">Fórmula</a>
                / Lotes </div>
        </div>
        <div class="filter-select">
            <div class="docbase"><span *ngIf="document !== 0"> Número de pedido: </span> <span class="spandoc"
                    *ngIf="document !== 0">{{document}}</span></div>
            <div class="docbase-status">Orden de fabricación: <span class="spnstatus">{{ordenFabricacionId}}</span>
            </div>
        </div>
    </div>
    <div class="description-container">
        <span
            [ngClass]="hasMissingStock ? 'color-missing-material' : 'color-omicron'">{{productId}}&nbsp;&nbsp;&nbsp;&nbsp;</span>|
        <span
            [ngClass]="hasMissingStock ? 'color-missing-material' : 'color-with-material'">&nbsp;&nbsp;&nbsp;&nbsp;{{description}}</span>
    </div>
    <div class="table-toolbar">
        <div class="table-toolbar-search">

        </div>
        <div class="table-toolbar-buttons">
            <button mat-raised-button class="button-blue" (click)="openDialog()">
                Agregar componente
            </button>
            <button mat-raised-button [ngClass]="isReadyToSave ? 'button-blue' : 'disable-button'"
                [disabled]="!isReadyToSave" (click)="buildObjectToSap()">
                &nbsp; Guardar &nbsp;
            </button>
        </div>
    </div>

    <div class="list-users-container">
        <table mat-table [dataSource]="dataSourceComponents" class="mat-elevation-z8" aria-describedby>

            <ng-container matColumnDef="cons">
                <th scope="row" mat-header-cell *matHeaderCellDef class="centered">#</th>
                <td mat-cell *matCellDef="let element; let i = index;"
                    class="color-text-intables tdcell tdcell-center column-cons"> {{i+1}} </td>
            </ng-container>

            <ng-container matColumnDef="codigoProducto">
                <th scope="row" mat-header-cell *matHeaderCellDef class=""> CÓDIGO DEL PRODUCTO</th>
                <td mat-cell *matCellDef="let element;" class="color-text-intables tdcell column-codigoProducto">
                    {{element.codigoProducto}}</td>
            </ng-container>

            <ng-container matColumnDef="descripcionProducto">
                <th scope="row" mat-header-cell *matHeaderCellDef class="mobile-hide"> DESCRIPCIÓN DEL PRODUCTO</th>
                <td mat-cell *matCellDef="let element;"
                    class="color-text-intables tdcell tdemail mobile-hide column-descripcionProducto">
                    {{element.description |
                    uppercase}} </td>
            </ng-container>

            <ng-container matColumnDef="cantidadBase">
                <th scope="row" mat-header-cell *matHeaderCellDef class="mobile-hide"> CTD. BASE </th>
                <td mat-cell *matCellDef="let element;let i = index;"
                    class="color-text-intables tdcell mobile-hide column-cantidadBase">
                    <mat-form-field style="width: 100px;" appearance="outline" *ngIf="!element.isContainer">
                        <input matInput type="number" [disabled]="element.hasBatches"
                            class="number color-number text-bold color-black" placeholder="Cantidad requerida"
                            [(ngModel)]="element.baseQuantity" (ngModelChange)="onBaseQuantityChange($event, i)"
                            appDigitDecimalNumber decimalPlaces="6">
                    </mat-form-field>
                </td>
            </ng-container>

            <ng-container matColumnDef="cantidadRequerida">
                <th scope="row" mat-header-cell *matHeaderCellDef class="mobile-hide"> CTD. REQUERIDA </th>
                <td mat-cell *matCellDef="let element;let i = index;"
                    class="color-text-intables tdcell mobile-hide column-cantidadRequerida">
                    <mat-form-field style="width: 100px;" appearance="outline" *ngIf="!element.isContainer">
                        <input matInput type="number" [disabled]="element.hasBatches"
                            class="number color-number text-bold color-black" placeholder="Cantidad requerida"
                            [(ngModel)]="element.requiredQuantity" (ngModelChange)="onRequiredQuantityChange($event, i)"
                            appDigitDecimalNumber decimalPlaces="6">
                    </mat-form-field>
                </td>
            </ng-container>

            <ng-container matColumnDef="consumido">
                <th scope="row" mat-header-cell *matHeaderCellDef class="mobile-hide"> CONSUMIDO </th>
                <td mat-cell *matCellDef="let element;let i = index;"
                    class="color-text-intables tdcell mobile-hide column-consumido"> {{element.consumed}} </td>
            </ng-container>

            <ng-container matColumnDef="disponible">
                <th scope="row" mat-header-cell *matHeaderCellDef class="mobile-hide"> DISPONIBLE </th>
                <td mat-cell *matCellDef="let element;let i = index;"
                    class="color-text-intables tdcell mobile-hide column-disponible"> {{element.available}} </td>
            </ng-container>

            <ng-container matColumnDef="unidad">
                <th scope="row" mat-header-cell *matHeaderCellDef class="mobile-hide"> DISPONIBLE </th>
                <td mat-cell *matCellDef="let element;let i = index;"
                    class="color-text-intables tdcell mobile-hide column-unidad"> {{element.unit}} </td>
            </ng-container>

            <ng-container matColumnDef="almacen">
                <th scope="row" mat-header-cell *matHeaderCellDef class="mobile-hide"> CÓDIGO DE ALMACÉN </th>
                <td mat-cell *matCellDef="let element;let i = index;"
                    class="color-text-intables tdcell mobile-hide column-almacen">
                    <mat-form-field appearance="outline" style="width: 100px;">
                        <mat-select [(ngModel)]="element.warehouse" (ngModelChange)="onSelectWareHouseChange($event, i)"
                            [disabled]="false">
                            <mat-option value="AMP">
                                AMP
                            </mat-option>
                            <mat-option value="BE">
                                BE
                            </mat-option>
                            <mat-option value="GENERAL">
                                GENERAL
                            </mat-option>
                            <mat-option value="INCI">
                                INCI
                            </mat-option>
                            <mat-option value="MER">
                                MER
                            </mat-option>
                            <mat-option value="MG">
                                MG
                            </mat-option>
                            <mat-option value="MN">
                                MN
                            </mat-option>
                            <mat-option value="MP">
                                MP
                            </mat-option>
                            <mat-option value="PROD">
                                PROD
                            </mat-option>
                            <mat-option value="PRONATUR">
                                PRONATUR
                            </mat-option>
                            <mat-option value="PT">
                                PT
                            </mat-option>
                            <mat-option value="TALLERES">
                                TALLERES
                            </mat-option>
                            <mat-option value="WEB">
                                WEB
                            </mat-option>
                        </mat-select>
                    </mat-form-field>
                </td>
            </ng-container>

            <ng-container matColumnDef="cantidadPendiente">
                <th scope="row" mat-header-cell *matHeaderCellDef class="mobile-hide"> CTD. PENDIENTE </th>
                <td mat-cell *matCellDef="let element;let i = index;"
                    class="color-text-intables tdcell mobile-hide column-cantidadPendiente"> {{element.pendingQuantity}}
                </td>
            </ng-container>

            <ng-container matColumnDef="enStock">
                <th scope="row" mat-header-cell *matHeaderCellDef class="mobile-hide"> STOCK </th>
                <td mat-cell *matCellDef="let element;let i = index;"
                    class="color-text-intables tdcell mobile-hide column-enStock"> {{element.stock}} </td>
            </ng-container>

            <ng-container matColumnDef="cantidadAlmacen">
                <th scope="row" mat-header-cell *matHeaderCellDef class="mobile-hide"> CTD. ALMACÉN </th>
                <td mat-cell *matCellDef="let element;let i = index;"
                    class="color-text-intables tdcell mobile-hide column-cantidadAlmacen"> {{element.warehouseQuantity}}
                </td>
            </ng-container>

            <ng-container matColumnDef="totalNecesario">
                <th scope="row" mat-header-cell *matHeaderCellDef class="mobile-hide"> TOTAL NECESARIO </th>
                <td mat-cell *matCellDef="let element;let i = index;"
                    class="color-text-intables tdcell mobile-hide column-totalNecesario"> {{element.totalNecesario}}
                </td>
            </ng-container>

            <ng-container matColumnDef="totalSeleccionado">
                <th scope="row" mat-header-cell *matHeaderCellDef class="mobile-hide"> TOTAL SELECCIONADO </th>
                <td mat-cell *matCellDef="let element;"
                    class="color-text-intables tdcell mobile-hide column-totalSeleccionado">
                    {{element.totalSeleccionado}} </td>
            </ng-container>

            <tr mat-header-row *matHeaderRowDef="detailsColumns" class="color-text-intables"></tr>
            <tr mat-row *matRowDef="let row; columns: detailsColumns;" class="clickable"
                [ngClass]="row.selected ? 'selected' : ''" (click)="setSelectedTr(row)"></tr>
        </table>
    </div>
    <div class="seleccion-lotes">
        <div class="column-a">
            <div class="title-list-container">
                <span>Lotes disponibles</span>
            </div>
            <table mat-table [dataSource]="dataSourceLotes" class="mat-elevation-z8 item-batches"
                style="margin-bottom: 20px !important;" aria-describedby>
                <ng-container matColumnDef="cons">
                    <th scope="row" mat-header-cell *matHeaderCellDef class="centered">LOTE</th>
                    <td mat-cell *matCellDef="let element;"
                        class="color-text-intables tdcell tdcell-center lotesconsecutivo">
                        {{element.numeroLote}}
                    </td>
                </ng-container>

                <ng-container matColumnDef="disponible">
                    <th scope="row" mat-header-cell *matHeaderCellDef class="mobile-hide"> CANTIDAD DISPONIBLE </th>
                    <td mat-cell *matCellDef="let element;" class="color-text-intables tdcell mobile-hide disponible">
                        {{element.cantidadDisponible}} </td>
                </ng-container>

                <ng-container matColumnDef="seleccionada">
                    <th scope="row" mat-header-cell *matHeaderCellDef class="mobile-hide"> CANTIDAD SELECCIONADA </th>
                    <td mat-cell *matCellDef="let element;"
                        class="color-text-intables tdcell mobile-hide lotesseleccionado">
                        <mat-form-field appearance="outline" class="generalinput" style="width: 70%;">
                            <input matInput type="number" class="number" placeholder="Cantidad seleccionada"
                                [(ngModel)]="element.cantidadSeleccionada ">
                        </mat-form-field>
                    </td>
                </ng-container>

                <ng-container matColumnDef="asignada">
                    <th scope="row" mat-header-cell *matHeaderCellDef class="mobile-hide"> CANTIDAD ASIGNADA </th>
                    <td mat-cell *matCellDef="let element;"
                        class="color-text-intables tdcell mobile-hide lotesasignados"> {{element.cantidadAsignada}}
                    </td>
                </ng-container>

                <ng-container matColumnDef="opciones">
                    <th scope="row" mat-header-cell *matHeaderCellDef class="centered"> ACCIONES </th>
                    <td mat-cell *matCellDef="let element" class="tdcell tdcell-center tdactions">
                        <button mat-icon-button class="ico-col-pri" (click)="addLotes(element)">
                            <mat-icon>arrow_forward_ios</mat-icon>
                        </button>
                    </td>
                </ng-container>
                <tr mat-header-row *matHeaderRowDef="lotesColumns" class="color-text-intables"></tr>
                <tr mat-row *matRowDef="let row; columns: lotesColumns;" [ngClass]="isDue(row) ? 'caduco' : ''"></tr>
            </table>
        </div>
        <div class="column-b">
            <div class="title-list-container">
                <span>Lotes seleccionados</span>
            </div>
            <table mat-table [dataSource]="dataSourceLotesAsignados" class="mat-elevation-z8 table-pl" aria-describedby>
                <ng-container matColumnDef="lote" [style.display]="element.action == 'delete' ? 'none' : 'true'">
                    <th scope="row" mat-header-cell *matHeaderCellDef class="centered">LOTE</th>
                    <td mat-cell *matCellDef="let element; let i = index;"
                        class="color-text-intables tdcell tdcell-center pllote"
                        [style.display]="element.action == 'delete' ? 'none' : 'true'"> {{element.numeroLote}} </td>
                </ng-container>
                <ng-container matColumnDef="seleccionada"
                    [style.display]="element.action == 'delete' ? 'none' : 'true'">
                    <th scope="row" mat-header-cell *matHeaderCellDef class="mobile-hide"> CANTIDAD SELECCIONADA </th>
                    <td mat-cell *matCellDef="let element;"
                        class="color-text-intables tdcell mobile-hide plseleccionada"
                        [style.display]="element.action == 'delete' ? 'none' : 'true'"> {{element.cantidadSeleccionada}}
                    </td>
                </ng-container>
                <ng-container matColumnDef="opciones" [style.display]="element.action == 'delete' ? 'none' : 'true'">
                    <th scope="row" mat-header-cell *matHeaderCellDef class="centered"> ACCIONES </th>
                    <td mat-cell *matCellDef="let element" class="tdcell tdcell-center tdactions"
                        [style.display]="element.action == 'delete' ? 'none' : 'true'">
                        <button mat-icon-button class="ico-col-pri" (click)="deleteLotes(element)">
                            <mat-icon>arrow_back_ios</mat-icon>
                        </button>
                    </td>
                </ng-container>
                <tr mat-header-row *matHeaderRowDef="lotesSelectedColumns" class="color-text-intables"></tr>
                <tr mat-row *matRowDef="let row; columns: lotesSelectedColumns;"
                    [ngClass]="getIsValid(row) ? '' : 'caduco'"></tr>
            </table>
        </div>
    </div>
</div>