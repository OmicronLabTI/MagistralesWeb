<div class="container-list-page">
    <div class="header-page">
        <div class="title-list-container">
            <span>Incidencias</span>
        </div>
        <div class="filter-select">
            <span class="dateType" >
                Fecha de creación:
            </span>
            <span class="date-selected">
            {{ filterDataIncidents.dateFull | dateformat }}
            </span>
        </div>
    </div>

    <div class="table-toolbar">
        <div class="refresh-icon-on-toolbar" (click)="updateIncidentList()">
            <span class="material-icons color-omicron cursor-pointer">
                refresh
            </span>
        </div>
        <div class="table-toolbar-buttons">
            <button mat-raised-button class="button-blue " (click)="openFindOrdersDialog()" >
                <mat-icon *ngIf="isSearchWithFilter">search
                </mat-icon>Buscar</button>
        </div>
    </div>
    <div class="list-users-container">
        <div  class="table-container scroll-custom">
            <table mat-table [dataSource]="dataSource"  [ngClass]="dataSource.data.length !== 0 ? 'mat-elevation-z8': ''">

                <ng-container matColumnDef="cons">
                    <th mat-header-cell *matHeaderCellDef class="centered">#</th>
                    <td mat-cell *matCellDef="let element; let i = index;" class="color-text-intables tdcell tdcell-center color-number "> {{i+1}} </td>
                    <td mat-footer-cell *matFooterCellDef></td>
                </ng-container>

                <ng-container matColumnDef="createDate">
                    <th mat-header-cell *matHeaderCellDef class="mobile-hide text-center"> FECHA INCIDENCIA </th>
                    <td mat-cell *matCellDef="let element" class="color-text-intables tdcell mobile-hide text-center"> {{element.createDate | date: 'dd/MM/yyyy'}} </td>
                </ng-container>

                <ng-container matColumnDef="saleOrder">
                    <th mat-header-cell *matHeaderCellDef class="mobile-hide">  PEDIDO</th>
                    <td mat-cell  *matCellDef="let element" class="color-text-intables tdcell tdphone mobile-hide "> {{element.saleOrder}} </td>
                </ng-container>

                <ng-container matColumnDef="delivery">
                    <th mat-header-cell *matHeaderCellDef class="mobile-hide">  REMISIÓN </th>
                    <td mat-cell *matCellDef="let element" class="color-text-intables tdcell mobile-hide">
                        {{element.delivery !== 0 ? element.delivery : '' }}
                    </td>
                </ng-container>

                <ng-container matColumnDef="invoice">
                    <th mat-header-cell *matHeaderCellDef class="mobile-hide">  FACTURA </th>
                    <td mat-cell *matCellDef="let element" class="color-text-intables tdcell mobile-hide asesor">
                        {{element.invoice  !== 0 ? element.invoice : '' }}
                    </td>
                </ng-container>

                <ng-container matColumnDef="itemCode">
                    <th mat-header-cell *matHeaderCellDef class="centered mobile-hide">  PRODUCTO </th>itemCode
                    <td mat-cell *matCellDef="let element" class="color-text-intables tdcell tdcell-center mobile-hide"> {{element.itemCode}} </td>
                </ng-container>

                <ng-container matColumnDef="type">
                    <th mat-header-cell *matHeaderCellDef class="centered mobile-hide">  TIPO </th>
                    <td mat-cell *matCellDef="let element" class="color-text-intables tdcell tdcell-center mobile-hide"> {{element.type}} </td>
                </ng-container>

                <ng-container matColumnDef="incident">
                    <th mat-header-cell *matHeaderCellDef class="centered mobile-hide">  TIPO DE FALLA </th>
                    <td mat-cell *matCellDef="let element" class="color-text-intables tdcell tdcell-center mobile-hide "> {{element.incident}} </td>
                </ng-container>

                <ng-container matColumnDef="stage">
                    <th mat-header-cell *matHeaderCellDef class="centered mobile-hide">  ETAPA </th>
                    <td mat-cell *matCellDef="let element" class="color-text-intables tdcell tdcell-center mobile-hide"> {{element.stage}}</td>
                </ng-container>

                <ng-container matColumnDef="batches">
                    <th mat-header-cell *matHeaderCellDef class="centered mobile-hide">LOTE / PIEZAS DAÑADAS </th>
                    <td mat-cell
                        matTooltip="{{element.batchesTooltip}}"
                        matTooltipPosition="right" *matCellDef="let element; let i = index;" class="color-text-intables tdcell tdcell-center mobile-hide">
                        <div class="batches-container">
                            <span *ngFor="let batcheTitle of element.batchesDisplay"> {{batcheTitle}}</span>
                        </div>
                </ng-container>

                <ng-container matColumnDef="comments">
                    <th mat-header-cell *matHeaderCellDef class="centered mobile-hide color-title-white">{{ '<<<<<<<<' }}  </th>
                    <td mat-cell *matCellDef="let element; let i = index;" class="color-text-intables tdcell tdcell-center mobile-hide">
                        <div class="center-status">
                            <svg xmlns="http://www.w3.org/2000/svg" *ngIf="element.comments === '' || element.comments.trim() === '&'" aria-hidden="true" focusable="false" width="2em" height="2em" style="-ms-transform: rotate(360deg); -webkit-transform: rotate(360deg); transform: rotate(360deg);" preserveAspectRatio="xMidYMid meet" viewBox="0 0 16 16"><g fill="#5480A6"><path fill-rule="evenodd" d="M2.678 11.894a1 1 0 0 1 .287.801a10.97 10.97 0 0 1-.398 2c1.395-.323 2.247-.697 2.634-.893a1 1 0 0 1 .71-.074A8.06 8.06 0 0 0 8 14c3.996 0 7-2.807 7-6c0-3.192-3.004-6-7-6S1 4.808 1 8c0 1.468.617 2.83 1.678 3.894zm-.493 3.905a21.682 21.682 0 0 1-.713.129c-.2.032-.352-.176-.273-.362a9.68 9.68 0 0 0 .244-.637l.003-.01c.248-.72.45-1.548.524-2.319C.743 11.37 0 9.76 0 8c0-3.866 3.582-7 8-7s8 3.134 8 7s-3.582 7-8 7a9.06 9.06 0 0 1-2.347-.306c-.52.263-1.639.742-3.468 1.105z"></path><path fill-rule="evenodd" d="M4 5.5a.5.5 0 0 1 .5-.5h7a.5.5 0 0 1 0 1h-7a.5.5 0 0 1-.5-.5zM4 8a.5.5 0 0 1 .5-.5h7a.5.5 0 0 1 0 1h-7A.5.5 0 0 1 4 8zm0 2.5a.5.5 0 0 1 .5-.5h4a.5.5 0 0 1 0 1h-4a.5.5 0 0 1-.5-.5z"></path></g></svg>
                            <svg (click)="openCommentsDialog(i)" class="cursor-pointer" xmlns="http://www.w3.org/2000/svg" *ngIf="element.comments !== '' && element.comments.trim() !== '&'" aria-hidden="true" focusable="false" width="2em" height="2em" style="-ms-transform: rotate(360deg); -webkit-transform: rotate(360deg); transform: rotate(360deg);" preserveAspectRatio="xMidYMid meet" viewBox="0 0 16 16"><g fill="#5480A6"><path fill-rule="evenodd" d="M16 8c0 3.866-3.582 7-8 7a9.06 9.06 0 0 1-2.347-.306c-.584.296-1.925.864-4.181 1.234c-.2.032-.352-.176-.273-.362c.354-.836.674-1.95.77-2.966C.744 11.37 0 9.76 0 8c0-3.866 3.582-7 8-7s8 3.134 8 7zM4.5 5a.5.5 0 0 0 0 1h7a.5.5 0 0 0 0-1h-7zm0 2.5a.5.5 0 0 0 0 1h7a.5.5 0 0 0 0-1h-7zm0 2.5a.5.5 0 0 0 0 1h4a.5.5 0 0 0 0-1h-4z"></path></g></svg>
                        </div>

                    </td>
                </ng-container>

                <ng-container matColumnDef="status">
                    <th mat-header-cell *matHeaderCellDef class="centered mobile-hide"> ESTATUS INCIDENCIA</th>
                    <td mat-cell *matCellDef="let element; let i = index;" class="color-text-intables tdcell tdcell-center mobile-hide">
                        <div class="center-status">
                            <button mat-stroked-button
                                    (click)="openChangeComments(i)" [ngClass]="element.classButton">{{element.status}}</button>
                        </div>
                </ng-container>

                <tr mat-header-row *matHeaderRowDef="displayedColumns" class="color-text-intables"></tr>
                <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
            </table>
            <div class="no-users-registered mat-elevation-z8" *ngIf="dataSource.data.length === 0">
                <span *ngIf="!isOnInit">No hay incidencias registradas</span>
                <span *ngIf="isOnInit"> Cargando incidencias ...</span>-
            </div>
            <div *ngIf="dataSource.data.length !== 0" class="paginator-container">
                <mat-paginator
                        [pageSizeOptions]="[5, 10, 15]"
                        [pageSize]="limit"
                        [length]="lengthPaginator"
                        [pageIndex]="pageIndex"
                        (page)="pageEvent = changeDataEvent($event)"
                ></mat-paginator>
            </div>
        </div>
    </div>
</div>


