<?xml version="1.0" encoding="UTF-8"?> 
<databaseChangeLog 
  xmlns="http://www.liquibase.org/xml/ns/dbchangelog/1.9" 
  xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" 
  xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog/1.9
                      http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-1.9.xsd"> 
  <changeSet author="gramirez" id="changelog-1.1">
    <createTable tableName="User">
      <column name="Id" type="VARCHAR(50)">
        <constraints nullable="false" primaryKey="true" unique="true"/>
      </column>
      <column name="UserName" type="VARCHAR(50)">
        <constraints nullable="false" primaryKey="false" unique="false"/>
      </column>	  
	  <column name="FirstName" type="VARCHAR(50)">
        <constraints nullable="false" primaryKey="false" unique="false"/>
      </column>
	  <column name="LastName" type="VARCHAR(50)">
        <constraints nullable="false" primaryKey="false" unique="false"/>
      </column>
	  <column name="Role" type="INT">
        <constraints nullable="false" primaryKey="false" unique="false"/>
      </column>
	  <column name="Password" type="VARCHAR(80)">
        <constraints nullable="false" primaryKey="false" unique="false"/>
      </column>	  
    </createTable>
  </changeSet>
  <changeSet author="gcruz" id="changelog-1.2">
    <createTable tableName="OrdersLogs">
      <column name="Id" type="INT" autoIncrement="true">
        <constraints nullable="false" primaryKey="true" unique="true"/>
      </column>
      <column name="LogDateTime" type="TIMESTAMP">
        <constraints nullable="false" primaryKey="false" unique="false"/>
      </column>	  
	  <column name="UserId" type="VARCHAR(50)">
        <constraints nullable="false"/>
      </column>
	  <column name="Type" type="VARCHAR(2)">
        <constraints nullable="false" primaryKey="false" unique="false"/>
      </column>
	  <column name="NoId" type="VARCHAR(50)">
        <constraints nullable="false" primaryKey="false" unique="false"/>
      </column>
    <column name="Description" type="VARCHAR(255)">
        <constraints nullable="false" primaryKey="false" unique="false"/>
      </column>	  
    </createTable>
  </changeSet>
  <changeSet author="gcruz" id="changelog-1.3">
    <createTable tableName="UsersOrders">
      <column name="Id" type="INT" autoIncrement="true">
        <constraints nullable="false" primaryKey="true" unique="true"/>
      </column>	  
	  <column name="UserId" type="VARCHAR(50)">
        <constraints nullable="true"/>
      </column>
	  <column name="SalesOrderId" type="VARCHAR(50)">
        <constraints nullable="false" primaryKey="false" unique="false"/>
      </column>
	  <column name="ProductionOrderId" type="VARCHAR(50)">
        <constraints nullable="false" primaryKey="false" unique="false"/>
      </column>
    <column name="Status" type="VARCHAR(20)">
        <constraints nullable="false" primaryKey="false" unique="false"/>
      </column>	  
    </createTable>
    <addForeignKeyConstraint baseColumnNames="UserId" baseTableName="OrdersLogs" constraintName="fk_orderslogs_id" referencedColumnNames="Id" referencedTableName="User"/>
    <addForeignKeyConstraint baseColumnNames="UserId" baseTableName="UsersOrders" constraintName="fk_userorders_id" referencedColumnNames="Id" referencedTableName="User"/>
  </changeSet>
  <changeSet author="gramirez" id="changelog-1.4">
	<renameTable
		newTableName="user"
		oldTableName="User"
	/>  
  </changeSet>
  <changeSet author="gramirez" id="changelog-1.5">
	<renameColumn  
		newColumnName="id"
		oldColumnName="Id"
		tableName="user"
	/>
  </changeSet>
  <changeSet author="gramirez" id="changelog-1.6">
	<renameColumn  
		newColumnName="username"
		oldColumnName="UserName"
		tableName="user"
	/>
  </changeSet>
  <changeSet author="gramirez" id="changelog-1.7">
	<renameColumn  
		newColumnName="firstname"
		oldColumnName="FirstName"
		tableName="user"
	/>
  </changeSet>
  <changeSet author="gramirez" id="changelog-1.8">
	<renameColumn  
		newColumnName="lastname"
		oldColumnName="LastName"
		tableName="user"
	/>
  </changeSet>
  <changeSet author="gramirez" id="changelog-1.9">
	<renameColumn  
		newColumnName="role"
		oldColumnName="Role"
		tableName="user"
	/>
  </changeSet>
  <changeSet author="gramirez" id="changelog-1.10">
	<renameColumn  
		newColumnName="password"
		oldColumnName="Password"
		tableName="user"
	/>
  </changeSet>
  <changeSet author="gcruz" id="changelog-1.11">
    <renameTable
      newTableName="orderslogs"
      oldTableName="OrdersLogs"
    />  
  </changeSet>
  <changeSet author="gcruz" id="changelog-1.12">
    <renameColumn  
      newColumnName="id"
      oldColumnName="Id"
      tableName="orderslogs"
    />
  </changeSet>
  <changeSet author="gcruz" id="changelog-1.13">
    <renameColumn  
      newColumnName="logdatetime"
      oldColumnName="LogDateTime"
      tableName="orderslogs"
    />
  </changeSet>
  <changeSet author="gcruz" id="changelog-1.14">
    <renameColumn  
      newColumnName="userid"
      oldColumnName="UserId"
      tableName="orderslogs"
    />
  </changeSet>
  <changeSet author="gcruz" id="changelog-1.15">
    <renameColumn  
      newColumnName="type"
      oldColumnName="Type"
      tableName="orderslogs"
    />
  </changeSet>
  <changeSet author="gcruz" id="changelog-1.16">
    <renameColumn  
      newColumnName="noid"
      oldColumnName="NoId"
      tableName="orderslogs"
    />
  </changeSet>
  <changeSet author="gcruz" id="changelog-1.17">
    <renameColumn  
      newColumnName="description"
      oldColumnName="Description"
      tableName="orderslogs"
    />
  </changeSet>
  <changeSet author="gcruz" id="changelog-1.18">
    <renameTable
      newTableName="usersorders"
      oldTableName="UsersOrders"
    />  
  </changeSet>
  <changeSet author="gcruz" id="changelog-1.19">
    <renameColumn  
      newColumnName="id"
      oldColumnName="Id"
      tableName="usersorders"
    />
  </changeSet>
  <changeSet author="gcruz" id="changelog-1.20">
    <renameColumn  
      newColumnName="userid"
      oldColumnName="UserId"
      tableName="usersorders"
    />
  </changeSet>
  <changeSet author="gcruz" id="changelog-1.21">
    <renameColumn  
      newColumnName="salesorderid"
      oldColumnName="SalesOrderId"
      tableName="usersorders"
    />
  </changeSet>
  <changeSet author="gcruz" id="changelog-1.22">
    <renameColumn  
      newColumnName="productionorderid"
      oldColumnName="ProductionOrderId"
      tableName="usersorders"
    />
  </changeSet>
  <changeSet author="gcruz" id="changelog-1.23">
    <renameColumn  
      newColumnName="status"
      oldColumnName="Status"
      tableName="usersorders"
    />
  </changeSet>
  <changeSet author="gramirez" id="changelog-1.24">
    <createTable tableName="roles">
      <column name="idrole" type="INT" autoIncrement="true">
        <constraints nullable="false" primaryKey="true" unique="true"/>
      </column>
      <column name="roledescription" type="VARCHAR(50)">
        <constraints nullable="false" primaryKey="false" unique="false"/>
      </column>
    </createTable>
  </changeSet>
  <changeSet author="gramirez" id="changelog-1.25">
	<addColumn tableName ="user">
		<column 
			name="activo"
			type="INT"
			defaultValue="0">
		</column>
	</addColumn>  
  </changeSet>
  <changeSet author="gramirez" id="changelog-1.26">
	<insert tableName="roles"> 
		<column name="roledescription" value="Administrador"/>
	</insert>
  </changeSet>
  <changeSet author="gramirez" id="changelog-1.27">
	<insert tableName="roles"> 
		<column name="roledescription" value="QFB"/>
	</insert>
  </changeSet>
  <changeSet author="gramirez" id="changelog-1.28">
    <dropNotNullConstraint tableName="usersorders" columnName="userid" columnDataType="varchar(50)"/>
  </changeSet>
  <changeSet author="gramirez" id="changelog-1.29">
    <dropNotNullConstraint tableName="usersorders" columnName="productionorderid" columnDataType="varchar(50)"/>
  </changeSet>
  <changeSet author="gramirez" id="changelog-1.30">
    <createTable tableName="parameters">
      <column name="Id" type="INT" autoIncrement="true">
        <constraints nullable="false" primaryKey="true" unique="true"/>
      </column>	  
      <column name="value" type="VARCHAR(500)">
        <constraints nullable="true" primaryKey="false" unique="false"/>
      </column>	  
	  <column name="type" type="VARCHAR(50)">
        <constraints nullable="false" primaryKey="false" unique="false"/>
      </column>
	  <column name="field" type="VARCHAR(100)">
        <constraints nullable="false" primaryKey="false" unique="false"/>
      </column>
    </createTable>
  </changeSet>
  <changeSet author="gramirez" id="changelog-1.31">
	<insert tableName="parameters"> 
		<column name="value" value="200"/>
		<column name="type" value="int"/>
		<column name="field" value="MaxUserOrders"/>
	</insert>
  </changeSet>
  <changeSet author="hmiguel" id="changelog-1.32">
    <addColumn tableName="usersorders" >
      <column name="comments" type="varchar(500)"> 
        <constraints nullable="true" />  
      </column>
    </addColumn>
  </changeSet>
  <changeSet author="hmiguel" id="changelog-1.33">
    <createTable tableName="userorderssignatures">
      <column name="id" type="INT" autoIncrement="true">
        <constraints nullable="false" primaryKey="true" unique="true"/>
      </column>	  
      <column name="userorderid" type="INT">
      </column>	  
	    <column name="technicalsignature" type="BYTEA">
        <constraints nullable="true" />  
      </column>
      <column name="logisticsignature" type="BYTEA">
        <constraints nullable="true" />  
      </column>
    </createTable>
    <addForeignKeyConstraint baseColumnNames="userorderid" baseTableName="userorderssignatures" constraintName="fk_userorderssignatures_userorders_id" referencedColumnNames="id" referencedTableName="usersorders"/>
  </changeSet>
  <changeSet author="gramirez" id="changelog-1.34">
	<addColumn tableName ="usersorders">
		<column 
			name="finishdate"
			type="VARCHAR(20)">
		</column>
	</addColumn>  
  </changeSet>
  <changeSet author="hmiguel" id="changelog-1.35">
	<addColumn tableName ="usersorders">
		<column 
			name="closedate"
			type="VARCHAR(20)">
		</column>
	</addColumn>  
  </changeSet>
  <changeSet author="hmiguel" id="changelog-1.36">
	<addColumn tableName ="usersorders">
		<column 
			name="closeuserid"
			type="VARCHAR(50)">
		</column>
	</addColumn>
	<addForeignKeyConstraint baseColumnNames="closeuserid" baseTableName="usersorders" constraintName="fk_close_userorders_users_id" referencedColumnNames="id" referencedTableName="user"/>	
  </changeSet>
  <changeSet author="gramirez" id="changelog-1.37">
	<addColumn tableName ="userorderssignatures">
		<column 
			name="qfbsignature"
			type="BYTEA">
		</column>
	</addColumn>	
  </changeSet>
  <changeSet author="hmiguel" id="changelog-1.38">
	<addColumn tableName ="usersorders">
		<column 
			name="creationdate"
			type="VARCHAR(30)">
		</column>
	</addColumn>
	<addColumn tableName ="usersorders">
		<column 
			name="creationuserid"
			type="VARCHAR(50)">
		</column>
	</addColumn>
	<addForeignKeyConstraint baseColumnNames="creationuserid" baseTableName="usersorders" constraintName="fk_creation_userorders_users_id" referencedColumnNames="id" referencedTableName="user"/>	
  </changeSet>
  <changeSet author="hmiguel" id="changelog-1.39">
    <createTable tableName="customcomponentlists">
      <column name="id" type="INT" autoIncrement="true">
        <constraints nullable="false" primaryKey="true" unique="true"/>
      </column>	
	  <column name="productid" type="VARCHAR(50)">
        <constraints nullable="false" />  
      </column> 
	  <column name="name" type="VARCHAR(100)">
        <constraints nullable="false" />  
      </column>
	  <column name="creationuserid" type="VARCHAR(50)">
		<constraints nullable="false" /> 
	  </column>
	  <column name="creationdate" type="VARCHAR(30)">
		<constraints nullable="false" /> 
	  </column>
    </createTable>
  </changeSet>
  <changeSet author="hmiguel" id="changelog-1.40">
    <createTable tableName="customcomponentlistscomponents">
      <column name="id" type="INT" autoIncrement="true">
        <constraints nullable="false" primaryKey="true" unique="true"/>
      </column>	  
      <column name="customlistid" type="INT">
      </column>	  
	  <column name="productid" type="VARCHAR(50)">
        <constraints nullable="false" />  
      </column>
	  <column name="description" type="VARCHAR(100)">
        <constraints nullable="false" />  
      </column>
	  <column name="basequantity" type="DECIMAL(19,6)">
        <constraints nullable="false" />  
      </column>  
    </createTable>
    <addForeignKeyConstraint baseColumnNames="customlistid" baseTableName="customcomponentlistscomponents" constraintName="fk_customcomponentlistscomponents_customcomponentlists_id" referencedColumnNames="id" referencedTableName="customcomponentlists"/>
  </changeSet>
  <changeSet author="gramirez" id="changelog-1.41">
	<insert tableName="roles"> 
		<column name="roledescription" value="Logistica"/>
	</insert>
  </changeSet>
  <changeSet author="gramirez" id="changelog-1.42">
	<addColumn tableName ="user">
		<column 
			name="pieces"
			type="INT"
			defaultValue="200">
		</column>
	</addColumn>  
  </changeSet>
  <changeSet author="hmiguel" id="changelog-1.43">
    <createTable tableName="rawmaterialrequest">
      <column name="id" type="INT" autoIncrement="true">
        <constraints nullable="false" primaryKey="true" unique="true"/>
      </column>	
	  <column name="productionorderid" type="INT">
        <constraints nullable="false" />  
      </column> 
	  <column name="signature" type="BYTEA">
        <constraints nullable="true" />  
      </column>
	  <column name="signinguserid" type="VARCHAR(50)">
        <constraints nullable="true" />  
      </column>
	  <column name="observations" type="NVARCHAR(500)">
		<constraints nullable="true" /> 
	  </column>
	  <column name="creationuserid" type="VARCHAR(50)">
		<constraints nullable="false" /> 
	  </column>
	  <column name="creationdate" type="VARCHAR(30)">
		<constraints nullable="false" /> 
	  </column>
    </createTable>
	<addForeignKeyConstraint baseColumnNames="creationuserid" baseTableName="rawmaterialrequest" constraintName="fk_rawmaterialrequest_creation_user_users_id" referencedColumnNames="id" referencedTableName="user"/>	
	<addForeignKeyConstraint baseColumnNames="signinguserid" baseTableName="rawmaterialrequest" constraintName="fk_rawmaterialrequest_signing_user_users_id" referencedColumnNames="id" referencedTableName="user"/>	
  </changeSet>
  <changeSet author="hmiguel" id="changelog-1.44">
    <createTable tableName="rawmaterialrequestdetail">
      <column name="id" type="INT" autoIncrement="true">
        <constraints nullable="false" primaryKey="true" unique="true"/>
      </column>	  
      <column name="rawmaterialrequestid" type="INT">
      </column>	  
	  <column name="productid" type="VARCHAR(50)">
        <constraints nullable="false" />  
      </column>
	  <column name="description" type="VARCHAR(100)">
        <constraints nullable="false" />  
      </column>
	  <column name="requestquantity" type="DECIMAL(19,6)">
        <constraints nullable="false" />  
      </column>  
    </createTable>
    <addForeignKeyConstraint baseColumnNames="rawmaterialrequestid" baseTableName="rawmaterialrequestdetail" constraintName="fk_rawmaterialrequestdetail_rawmaterialrequest_id" referencedColumnNames="id" referencedTableName="rawmaterialrequest"/>
  </changeSet>
  <changeSet author="hmiguel" id="changelog-1.50"> 
	<sql endDelimiter=";">
        ALTER TABLE customcomponentlistscomponents ALTER COLUMN description TYPE VARCHAR(255)
    </sql>
  </changeSet>
  <changeSet author="gramirez" id="changelog-1.51">
    <sql endDelimiter=";">
        update roles set roledescription = 'LOGÍSTICA' where idrole = 3
    </sql>
</changeSet>
<changeSet author="gramirez" id="changelog-1.52">
    <sql endDelimiter=";">
        update roles set roledescription = 'ADMINISTRACIÓN' where idrole = 1
    </sql>
</changeSet>
<changeSet author="gramirez" id="changelog-1.53">
    <sql endDelimiter=";">
        update roles set roledescription = 'ADMINISTRADOR' where idrole = 1
    </sql>
</changeSet>
</databaseChangeLog> 