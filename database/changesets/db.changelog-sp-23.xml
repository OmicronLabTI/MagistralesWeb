<?xml version="1.0" encoding="UTF-8"?>
<databaseChangeLog xmlns="http://www.liquibase.org/xml/ns/dbchangelog/1.9"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog/1.9 http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-1.9.xsd">

	<changeSet id="changelog-1.1" author="daniel.vargas">
		<createTable tableName="invoiceerrors">
			<column name="id" type="integer">
				<constraints primaryKey="true" nullable="false"/>
			</column>
			<column name="code" type="varchar(100)">
				<constraints nullable="false"/>
			</column>
			<column name="error" type="varchar(255)">
				<constraints nullable="false"/>
			</column>
			<column name="errormessage" type="varchar(255)"/>
			<column name="requiremanualchange" type="boolean" defaultValueBoolean="false"/>
		</createTable>
	</changeSet>


	<changeSet id="changelog-1.2" author="daniel.vargas">
		<createTable tableName="remissions">
			<column name="id" type="bigint" autoIncrement="true">
				<constraints primaryKey="true" nullable="false"/>
			</column>
			<column name="idremission" type="integer">
				<constraints nullable="false"/>
			</column>
			<column name="idinvoice" type="varchar(100)">
				<constraints nullable="false"/>
			</column>
		</createTable>
	</changeSet>


	<changeSet id="changelog-1.3" author="daniel.vargas">
		<createTable tableName="saporders">
			<column name="id" type="bigint" autoIncrement="true">
				<constraints primaryKey="true" nullable="false"/>
			</column>
			<column name="idpedidosap" type="integer">
				<constraints nullable="false"/>
			</column>
			<column name="idinvoice" type="varchar(100)">
				<constraints nullable="false"/>
			</column>
		</createTable>
	</changeSet>

	<changeSet id="changelog-1.4" author="daniel.vargas">
		<createTable tableName="invoices">
			<column name="id" type="varchar(100)">
				<constraints primaryKey="true" nullable="false"/>
			</column>
			<column name="pedidodxp" type="VARCHAR(40)"/>
			<column name="idinvoiceerror" type="integer">
				<constraints primaryKey="false" nullable="true"/>
			</column>
			<column name="createdate" type="timestamp"/>
			<column name="almacenuser" type="varchar(50)"/>
			<column name="estatus" type="varchar(50)"/>
			<column name="idfacturasap" type="integer">
				<constraints primaryKey="false" nullable="true"/>
			</column>
			<column name="tipofactura" type="varchar(50)"/>
			<column name="formafacturacion" type="varchar(50)"/>
			<column name="invoicecreatedate" type="timestamp"/>
			<column name="errormessage" type="varchar(255)"/>
			<column name="updatedate" type="timestamp"/>
			<column name="retrynumber" type="integer" defaultValueNumeric="0"/>
			<column name="type" type="varchar(50)"/>
			<column name="manualchangeapplied" type="boolean">
				<constraints primaryKey="false" nullable="true"/>
			</column>
			<column name="isprocessing" type="boolean" defaultValueBoolean="false"/>
		</createTable>
	</changeSet>

	<!-- Llaves foráneas -->
	<changeSet id="changelog-1.5" author="daniel.vargas">
		<!-- Invoice → InvoiceErrors -->
		<addForeignKeyConstraint baseTableName="invoices" baseColumnNames="idinvoiceerror" referencedTableName="invoiceerrors" referencedColumnNames="id" constraintName="fk_invoices_invoice_errors" onDelete="SET NULL"/>

		<!-- Remissions → Invoices -->
		<addForeignKeyConstraint baseTableName="remissions" baseColumnNames="idinvoice" referencedTableName="invoices" referencedColumnNames="id" constraintName="fk_remissions_invoices" onDelete="CASCADE"/>

		<!-- SapOrders → Invoices -->
		<addForeignKeyConstraint baseTableName="saporders" baseColumnNames="idinvoice" referencedTableName="invoices" referencedColumnNames="id" constraintName="fk_saporders_invoices" onDelete="CASCADE"/>
	</changeSet>
	<changeSet author="jarturoep" id="changelog-1.6">
		<addColumn tableName="invoices">
			<column name="payload" type="JSON">
				<constraints nullable="false" />
			</column>
		</addColumn>
	</changeSet>
</databaseChangeLog>